#!/usr/bin/env php
<?php

declare(strict_types=1);

namespace webignition\TcpCliProxyServer\Bin;

use webignition\TcpCliProxyServer\Server;
use webignition\TcpCliProxyServer\Services\Logger;

const VERSION = 'dev-master';

$pharPath = \Phar::running(false);

if ('' === $pharPath) {
    require 'vendor/autoload.php';
} else {
    require 'phar://server.phar/vendor/autoload.php';
}

try {
    $streamingServer = Server::create('0.0.0.0', 8000);

    pcntl_async_signals(true);
    pcntl_signal(SIGINT, function () use ($streamingServer) {
        $streamingServer->stop();
    });
    $streamingServer->run();
} catch (\Exception $exception) {
    $logger = new Logger();
    $logger->logException($exception);
}
